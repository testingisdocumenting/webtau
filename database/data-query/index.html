<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" /> 
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"> 
<title>WebTau: Data Query</title>
<link rel="stylesheet" type="text/css" href="/webtau/static/css/katex.min.css">
<link rel="stylesheet" type="text/css" href="/webtau/static/main.css">
<link rel="stylesheet" type="text/css" href="/webtau/logo.css">
<link rel="stylesheet" type="text/css" href="/webtau/static/css/global-overrides.css">
</head>
<link rel="shortcut icon" href="/webtau/favicon.png"type="image/ico"/>
<body class="theme-znai-dark">
<script>(function() {
    var themeNameKey = 'znaiTheme';
    var darkThemeName = 'znai-dark';
    var lightThemeName = 'default';

    var znaiTheme = {
        changeHandlers: [],
        addChangeHandler(handler) {
            this.changeHandlers.push(handler);
        },
        removeChangeHandler(handler) {
            var idx = this.changeHandlers.indexOf(handler);
            this.changeHandlers.splice(idx, 1);
        },
        set(name) {
            this.name = name;
            document.body.className = 'theme-' + name;

            var idx = 0;
            var len = this.changeHandlers.length;
            for (; idx < len; idx++) {
                this.changeHandlers[idx](name);
            }
        },
        setExplicitly(name) {
            storeThemeName(name);
            this.set(name);
        },
        setExplicitlyIfNotSetAlready(name) {
            const themeName = getStoredThemeName();
            if (themeName) {
                return
            }

            this.setExplicitly(name)
        },
        toggle() {
            this.setExplicitly(this.name === lightThemeName ? darkThemeName : lightThemeName)
        }
    };

    var mediaThemeName = setLightMatchMediaListenerAndGetThemeName()
    var themeName = getStoredThemeName() || mediaThemeName;
    znaiTheme.set(themeName);

    window.znaiTheme = znaiTheme;

    function getStoredThemeName() {
        return localStorage.getItem(themeNameKey);
    }

    function storeThemeName(name) {
        return localStorage.setItem(themeNameKey, name);
    }

    function setLightMatchMediaListenerAndGetThemeName() {
        if (!window.matchMedia) {
            return darkThemeName;
        }

        var lightQuery = window.matchMedia('(prefers-color-scheme: light)');
        lightQuery.addListener(function (e) {
            const newThemeName = e.matches ? lightThemeName : darkThemeName;
            znaiTheme.setExplicitly(newThemeName);
        });

        return lightQuery.matches ? lightThemeName : darkThemeName;
    }
})()</script>
<div id="znai"><div id="znai-initial-page-loading" style="margin: -20px 0 0 -20px; padding: 0 40px 40px 0; width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center">
    <div></div>
</div><section style="max-width: 640px; margin-left: auto; margin-right: auto;">
<article>
<header><h1>Full Table</h1></header>
<p>To query all data from a table use: def PRICES = db.table(&quot;PRICES&quot;) PRICES.should == [&quot;ID&quot; | &quot;DESCRIPTION&quot; | &quot;PRICE&quot;] { ___________________________________ &quot;id1&quot; | &quot;nice set&quot; | 1000 &quot;id2&quot; | &quot;another set&quot; | 2000 }</p>
</article>

<article>
<header><h1>Custom Query</h1></header>
<p>def prices = db.query(&quot;select * from PRICES where id=:id&quot;, [id: &quot;id1&quot;]) prices.should == [&quot;ID&quot; | &quot;DESCRIPTION&quot; | &quot;PRICE&quot;] { ___________________________________ &quot;id1&quot; | &quot;nice set&quot; | 1000 } def prices = db.query(&quot;select * from PRICES where id=:id&quot;, [id: &quot;id1&quot;]) prices.should == [ID: &quot;id1&quot;, &quot;DESCRIPTION&quot;: &quot;nice set&quot;, PRICE: 1000] def prices = db.query(&quot;select * from PRICES where id in (:ids)&quot;, [ids: [&quot;id1&quot;, &quot;id2&quot;]]) prices.should == [&quot;ID&quot; | &quot;DESCRIPTION&quot; | &quot;PRICE&quot;] { ___________________________________ &quot;id1&quot; | &quot;nice set&quot; | 1000 &quot;id2&quot; | &quot;another set&quot; | 2000 }</p>
</article>

<article>
<header><h1>Named Parameter Shortcut</h1></header>
<p>If your query uses a single unique placeholder name, you can pass a regular value instead of a java.util.Map def prices = db.query(&quot;select * from PRICES where id=:id or external_id=:id&quot;, &quot;id1&quot;) prices.should == [ID: &quot;id1&quot;, &quot;DESCRIPTION&quot;: &quot;nice set&quot;, PRICE: 1000]</p>
</article>

<article>
<header><h1>Lazy Declaration</h1></header>
<p>query doesn't query database at the call time. It defines a query to be used later. def prices = db.query(&quot;select * from PRICES&quot;) prices.shouldNot == [] db.update(&quot;delete from PRICES&quot;) prices.should == [] def PRICES = db.table(&quot;PRICES&quot;) def numberOfItems = PRICES.queryCount() numberOfItems.shouldNot == 0 db.update(&quot;delete from PRICES&quot;) numberOfItems.should == 0</p>
</article>

<article>
<header><h1>Single Value</h1></header>
<p>def price = db.query(&quot;select price from PRICES where id=:id&quot;, [id: 'id1']) price.should == 1000 price.shouldNot == 2000</p>
</article>

<article>
<header><h1>Wait On Result</h1></header>
<p>Use waitTo on query result to continuously query database until condition is met or timeout is reached. def count = db.query(&quot;select count(*) from PRICES&quot;) count.should == 2 // event happen somewhere to increase the number of rows... count.waitTo == 3</p>
</article>

<article>
<header><h1>Query Result Value</h1></header>
<p>Value returned from query methods is an instance of DbQuery type. No actual query is performed when DbQuery instance is created. It holds information about what query is, and what its parameters and only performs query when validation is triggered.Use queryXXX to access underlying value. def price = db.query(&quot;select price from PRICES where id=:id&quot;, [id: 'id1']) if (price.singleValue() &gt; 100) { println(&quot;do something&quot;) } Avoid: When you use queryXXX for assertions you may lose additional report information</p>
</article>
</section>
</div>
<script type="text/javascript" src="/webtau/footer.js"></script>
<script type="text/javascript" src="/webtau/toc.js"></script>
<script type="text/javascript" src="/webtau/global-anchors.js"></script>
<script type="text/javascript" src="/webtau/documentation-references.js"></script>
<script type="text/javascript" src="/webtau/assets.js"></script>
<script type="text/javascript" src="/webtau/static/main.js"></script>
<script type="text/javascript" src="/webtau/search-index.js"></script>
<script>
document.getElementById('znai').innerHTML = '';
/*<!--*/
ReactDOM.render(React.createElement(Documentation, {
  "docMeta" : {
    "viewOn" : {
      "link" : "https://github.com/testingisdocumenting/webtau/tree/master/webtau-docs/znai",
      "title" : "View On GitHub"
    },
    "id" : "webtau",
    "title" : "WebTau",
    "type" : "Guide",
    "previewEnabled" : false,
    "allowedGroups" : [ "admin" ]
  },
  "page" : {
    "type" : "Page",
    "content" : [ {
      "id" : "full-table",
      "type" : "Section",
      "title" : "Full Table",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "To query all data from a table use:",
          "type" : "SimpleText"
        } ]
      }, {
        "endLine" : "query whole table end",
        "snippet" : "def PRICES = db.table(\"PRICES\")\nPRICES.should == [\"ID\" | \"DESCRIPTION\" | \"PRICE\"] {\n                 ___________________________________\n                 \"id1\" | \"nice set\"    | 1000\n                 \"id2\" | \"another set\" | 2000 }",
        "entry" : "query method on table should be optional during comparison",
        "excludeStartEnd" : true,
        "bodyOnly" : true,
        "startLine" : "query whole table start",
        "type" : "Snippet",
        "title" : "validate whole table",
        "lang" : "groovy"
      } ]
    }, {
      "id" : "custom-query",
      "type" : "Section",
      "title" : "Custom Query",
      "content" : [ {
        "endLine" : "query with where clause end",
        "snippet" : "def prices = db.query(\"select * from PRICES where id=:id\", [id: \"id1\"])\nprices.should == [\"ID\" | \"DESCRIPTION\" | \"PRICE\"] {\n                 ___________________________________\n                 \"id1\" | \"nice set\"    | 1000     }",
        "entry" : "query table with select statement and param",
        "excludeStartEnd" : true,
        "bodyOnly" : true,
        "startLine" : "query with where clause start",
        "type" : "Snippet",
        "title" : "validate parts of a table",
        "lang" : "groovy"
      }, {
        "endLine" : "query with where clause end",
        "snippet" : "def prices = db.query(\"select * from PRICES where id=:id\", [id: \"id1\"])\nprices.should == [ID: \"id1\", \"DESCRIPTION\": \"nice set\", PRICE: 1000]",
        "entry" : "query table to match one row and assert against map",
        "excludeStartEnd" : true,
        "bodyOnly" : true,
        "startLine" : "query with where clause start",
        "type" : "Snippet",
        "title" : "validate parts of a table against map",
        "lang" : "groovy"
      }, {
        "endLine" : "query with where clause end",
        "snippet" : "def prices = db.query(\"select * from PRICES where id in (:ids)\", [ids: [\"id1\", \"id2\"]])\nprices.should == [\"ID\" | \"DESCRIPTION\" | \"PRICE\"] {\n                 ___________________________________\n                 \"id1\" | \"nice set\"    | 1000\n                 \"id2\" | \"another set\" | 2000     }",
        "entry" : "query table with select statement and array param",
        "excludeStartEnd" : true,
        "bodyOnly" : true,
        "startLine" : "query with where clause start",
        "type" : "Snippet",
        "title" : "use array as input",
        "lang" : "groovy"
      } ]
    }, {
      "id" : "named-parameter-shortcut",
      "type" : "Section",
      "title" : "Named Parameter Shortcut",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "If your query uses a single unique placeholder name, you can pass a regular value instead of a ",
          "type" : "SimpleText"
        }, {
          "code" : "java.util.Map",
          "type" : "InlinedCode"
        } ]
      }, {
        "endLine" : "query with where clause end",
        "snippet" : "def prices = db.query(\"select * from PRICES where id=:id or external_id=:id\", \"id1\")\nprices.should == [ID: \"id1\", \"DESCRIPTION\": \"nice set\", PRICE: 1000]",
        "entry" : "query table to match one row using single param shortcut and assert against map",
        "excludeStartEnd" : true,
        "bodyOnly" : true,
        "startLine" : "query with where clause start",
        "type" : "Snippet",
        "title" : "use regular value in case of one unique placeholder name",
        "lang" : "groovy"
      } ]
    }, {
      "id" : "lazy-declaration",
      "type" : "Section",
      "title" : "Lazy Declaration",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "code" : "query",
          "type" : "InlinedCode"
        }, {
          "text" : " doesn't query database at the call time. It defines a query to be used later.",
          "type" : "SimpleText"
        } ]
      }, {
        "endLine" : "query with where clause end",
        "snippet" : "def prices = db.query(\"select * from PRICES\")\n\nprices.shouldNot == []\ndb.update(\"delete from PRICES\")\nprices.should == []",
        "entry" : "create query is lazy",
        "excludeStartEnd" : true,
        "bodyOnly" : true,
        "startLine" : "query with where clause start",
        "type" : "Snippet",
        "title" : "create query is lazy",
        "lang" : "groovy"
      }, {
        "endLine" : "query with where clause end",
        "snippet" : "def PRICES = db.table(\"PRICES\")\ndef numberOfItems = PRICES.queryCount()\n\nnumberOfItems.shouldNot == 0\ndb.update(\"delete from PRICES\")\nnumberOfItems.should == 0",
        "entry" : "lazy count query",
        "excludeStartEnd" : true,
        "bodyOnly" : true,
        "startLine" : "query with where clause start",
        "type" : "Snippet",
        "title" : "lazy count query",
        "lang" : "groovy"
      } ]
    }, {
      "id" : "single-value",
      "type" : "Section",
      "title" : "Single Value",
      "content" : [ {
        "endLine" : "query single value params end",
        "snippet" : "def price = db.query(\"select price from PRICES where id=:id\", [id: 'id1'])\nprice.should == 1000\nprice.shouldNot == 2000",
        "entry" : "should query single value with params",
        "excludeStartEnd" : true,
        "bodyOnly" : true,
        "startLine" : "query single value params start",
        "type" : "Snippet",
        "title" : "validate single value",
        "lang" : "groovy"
      } ]
    }, {
      "id" : "wait-on-result",
      "type" : "Section",
      "title" : "Wait On Result",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Use ",
          "type" : "SimpleText"
        }, {
          "code" : "waitTo",
          "type" : "InlinedCode"
        }, {
          "text" : " on query result to continuously query database until condition is met or timeout is reached.",
          "type" : "SimpleText"
        } ]
      }, {
        "endLine" : "query with where clause end",
        "snippet" : "def count = db.query(\"select count(*) from PRICES\")\ncount.should == 2\n\n// event happen somewhere to increase the number of rows...\ncount.waitTo == 3",
        "entry" : "wait for count to change",
        "excludeStartEnd" : true,
        "bodyOnly" : true,
        "startLine" : "query with where clause start",
        "type" : "Snippet",
        "title" : "wait for count to change",
        "lang" : "groovy"
      } ]
    }, {
      "id" : "query-result-value",
      "type" : "Section",
      "title" : "Query Result Value",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Value returned from ",
          "type" : "SimpleText"
        }, {
          "code" : "query",
          "type" : "InlinedCode"
        }, {
          "text" : " methods is an instance of ",
          "type" : "SimpleText"
        }, {
          "code" : "DbQuery",
          "type" : "InlinedCode"
        }, {
          "text" : " type.",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "No actual query is performed when ",
          "type" : "SimpleText"
        }, {
          "code" : "DbQuery",
          "type" : "InlinedCode"
        }, {
          "text" : " instance is created. It holds information about what query is, and what its parameters",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "and only performs query when validation is triggered.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Use ",
          "type" : "SimpleText"
        }, {
          "code" : "queryXXX",
          "type" : "InlinedCode"
        }, {
          "text" : " to access underlying value.",
          "type" : "SimpleText"
        } ]
      }, {
        "endLine" : "single value access end",
        "snippet" : "def price = db.query(\"select price from PRICES where id=:id\", [id: 'id1'])\nif (price.singleValue() > 100) {\n    println(\"do something\")\n}",
        "entry" : "value returned from query is a special wrapper value",
        "excludeStartEnd" : true,
        "bodyOnly" : true,
        "startLine" : "single value access start",
        "type" : "Snippet",
        "title" : "access single value",
        "lang" : "groovy"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Avoid: When you use ",
          "type" : "SimpleText"
        }, {
          "code" : "queryXXX",
          "type" : "InlinedCode"
        }, {
          "text" : " for assertions you may lose additional report information",
          "type" : "SimpleText"
        } ]
      } ]
    } ],
    "lastModifiedTime" : 1640922026332,
    "tocItem" : {
      "sectionTitle" : "Database",
      "pageTitle" : "Data Query",
      "pageMeta" : { },
      "dirName" : "database",
      "fileName" : "data-query",
      "viewOnRelativePath" : null,
      "pageSectionIdTitles" : [ {
        "title" : "Full Table",
        "id" : "full-table"
      }, {
        "title" : "Custom Query",
        "id" : "custom-query"
      }, {
        "title" : "Named Parameter Shortcut",
        "id" : "named-parameter-shortcut"
      }, {
        "title" : "Lazy Declaration",
        "id" : "lazy-declaration"
      }, {
        "title" : "Single Value",
        "id" : "single-value"
      }, {
        "title" : "Wait On Result",
        "id" : "wait-on-result"
      }, {
        "title" : "Query Result Value",
        "id" : "query-result-value"
      } ]
    }
  }
}), document.getElementById("znai"));
/*-->*/

</script>

</body>
</html>
